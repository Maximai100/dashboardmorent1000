# Исправлено: Отображение ссылок в проектах

## Проблема
При добавлении ссылки к проекту:
- Ссылка создавалась в Directus
- Но в интерфейсе отображалась как "---" вместо названия
- После перезагрузки ссылка не отображалась корректно

## Причина
Несоответствие регистра полей между фронтендом и Directus:
- **Directus** использует поля `URL` и `Title` (с заглавной буквы)
- **Фронтенд** отправлял и ожидал `url` и `title` (с маленькой буквы)
- API Directus чувствителен к регистру → данные не сохранялись/не читались

## Решение

### 1. Обновлены типы (types/manager.ts)

**DirectusFile:**
```typescript
export interface DirectusFile {
    // ... существующие поля
    URL?: string;   // Custom field for links
    Title?: string; // Custom field for links
}
```

**ProjectAttachment:**
```typescript
export interface ProjectAttachment {
    // ... существующие поля
    url?: string;   // lowercase для совместимости
    URL?: string;   // Directus использует uppercase
    title?: string; // lowercase для совместимости
    Title?: string; // Directus использует uppercase
}
```

### 2. Исправлено сохранение ссылок (ProjectDetailModal.tsx)

**Было:**
```typescript
payload.url = att.url.trim();
payload.title = att.title.trim();
```

**Стало:**
```typescript
payload.URL = att.url.trim();   // Directus ожидает URL
payload.Title = att.title.trim(); // Directus ожидает Title
```

### 3. Исправлено отображение (ProjectDetailModal.tsx)

**Было:**
```typescript
const isLink = !!att.url;
const title = att.title || 'Файл';
```

**Стало:**
```typescript
const linkUrl = att.URL || att.url;  // Проверяем оба варианта
const isLink = !!linkUrl;
const displayTitle = att.Title || att.title || 'Файл';  // Проверяем оба варианта
```

### 4. Исправлено отображение в таблице (ProjectRow.tsx)

**Было:**
```typescript
if (att.url) {
    return <a href={att.url} title={att.title || att.url}>...</a>;
}
```

**Стало:**
```typescript
const linkUrl = att.URL || att.url;
const linkTitle = att.Title || att.title;
if (linkUrl) {
    return <a href={linkUrl} title={linkTitle || linkUrl}>...</a>;
}
```

## Как работает

### Добавление ссылки:
1. Пользователь вводит URL и название
2. Создается attachment с полями `url` и `title` (lowercase)
3. При сохранении отправляются как `URL` и `Title` (uppercase)
4. Directus сохраняет в junction table с правильными полями

### Отображение ссылки:
1. Directus возвращает attachment с полями `URL` и `Title`
2. Код проверяет оба варианта: `URL || url` и `Title || title`
3. Ссылка отображается с правильным названием
4. Клик открывает ссылку в новой вкладке

## Проверка

1. Откройте проект
2. Нажмите "Добавить ссылку"
3. Введите URL: `https://example.com`
4. Введите название: `Пример ссылки`
5. Нажмите "Сохранить ссылку"
6. Ссылка должна отображаться с названием "Пример ссылки"
7. Нажмите "Сохранить изменения"
8. Перезагрузите страницу
9. Ссылка должна остаться с правильным названием

## Совместимость

Код поддерживает оба варианта полей:
- `url` / `URL` - для обратной совместимости
- `title` / `Title` - для обратной совместимости

Это позволяет работать с:
- Старыми данными (lowercase)
- Новыми данными (uppercase из Directus)
- Локальным состоянием (lowercase)

## Статус

✅ Ссылки сохраняются с правильными полями  
✅ Ссылки отображаются с названием  
✅ Ссылки работают после перезагрузки  
✅ Обратная совместимость сохранена  

---

**Дата:** 11.10.2025  
**Файлы:** types/manager.ts, components/manager/ProjectDetailModal.tsx, components/manager/ProjectRow.tsx
