â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          ğŸ” ĞšĞĞš ĞĞĞ™Ğ¢Ğ˜ ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜Ğ® NGINX                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ĞŸĞĞ”ĞšĞ›Ğ®Ğ§Ğ˜Ğ¢Ğ•Ğ¡Ğ¬ Ğš Ğ¡Ğ•Ğ Ğ’Ğ•Ğ Ğ£:

    ssh user@1.cycloscope.online

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ğ¨ĞĞ“ 1: ĞŸĞ ĞĞ’Ğ•Ğ Ğ¬Ğ¢Ğ•, Ğ§Ğ¢Ğ NGINX Ğ£Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•Ğ

    nginx -v

Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ²ĞµÑ€ÑĞ¸Ñ, Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: nginx version: nginx/1.18.0

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ğ¨ĞĞ“ 2: ĞĞĞ™Ğ”Ğ˜Ğ¢Ğ• Ğ“Ğ›ĞĞ’ĞĞ«Ğ™ ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜ĞĞĞĞ«Ğ™ Ğ¤ĞĞ™Ğ›

    nginx -t

Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ¶ĞµÑ‚ Ğ¿ÑƒÑ‚ÑŒ Ğº ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸, Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€:
nginx: configuration file /etc/nginx/nginx.conf test is successful

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ğ¨ĞĞ“ 3: ĞĞĞ™Ğ”Ğ˜Ğ¢Ğ• ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜Ğ® Ğ”Ğ›Ğ¯ DIRECTUS

ĞĞ±Ñ‹Ñ‡Ğ½Ğ¾ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ ÑĞ°Ğ¹Ñ‚Ğ¾Ğ² Ğ½Ğ°Ñ…Ğ¾Ğ´ÑÑ‚ÑÑ Ğ²:

    # Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 1 (Ubuntu/Debian):
    ls -la /etc/nginx/sites-available/
    ls -la /etc/nginx/sites-enabled/

    # Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 2 (CentOS/RHEL):
    ls -la /etc/nginx/conf.d/

    # Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 3 (Docker):
    docker exec nginx ls -la /etc/nginx/conf.d/

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ğ¨ĞĞ“ 4: ĞĞĞ™Ğ”Ğ˜Ğ¢Ğ• Ğ¤ĞĞ™Ğ› Ğ¡ ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞĞœĞ˜ DIRECTUS

Ğ˜Ñ‰Ğ¸Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ», ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ "1.cycloscope.online":

    grep -r "1.cycloscope.online" /etc/nginx/

    # Ğ˜Ğ»Ğ¸
    grep -r "cycloscope" /etc/nginx/

    # Ğ˜Ğ»Ğ¸ Ğ¸Ñ‰Ğ¸Ñ‚Ğµ Ğ¿Ğ¾ Ğ¿Ğ¾Ñ€Ñ‚Ñƒ Directus (Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ 8055):
    grep -r "8055" /etc/nginx/

Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ¶ĞµÑ‚ Ñ„Ğ°Ğ¹Ğ», Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€:
/etc/nginx/sites-available/directus

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ğ¨ĞĞ“ 5: ĞĞĞ™Ğ”Ğ˜Ğ¢Ğ• ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ˜ CORS

ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»:

    sudo nano /etc/nginx/sites-available/directus

Ğ˜Ñ‰Ğ¸Ñ‚Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ñ:
- Access-Control-Allow-Origin
- add_header
- morent-sochi.vercel.app

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ğ¨ĞĞ“ 6: Ğ”ĞĞ‘ĞĞ’Ğ¬Ğ¢Ğ• ĞĞĞ’Ğ«Ğ™ Ğ”ĞĞœĞ•Ğ

ĞĞ°Ğ¹Ğ´Ğ¸Ñ‚Ğµ ÑÑ‚Ñ€Ğ¾ĞºÑƒ Ñ‚Ğ¸Ğ¿Ğ°:

    add_header 'Access-Control-Allow-Origin' 'https://morent-sochi.vercel.app' always;

Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ Ğ½Ğ°:

    add_header 'Access-Control-Allow-Origin' 'https://morent-sochi.vercel.app, https://dashboardmorent.vercel.app' always;

Ğ˜Ğ»Ğ¸ ĞµÑĞ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ:

    set $cors_origin "";
    if ($http_origin ~* (https://morent-sochi\.vercel\.app|https://dashboardmorent\.vercel\.app)) {
        set $cors_origin $http_origin;
    }
    add_header 'Access-Control-Allow-Origin' $cors_origin always;

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ğ¨ĞĞ“ 7: ĞŸĞ ĞĞ’Ğ•Ğ Ğ¬Ğ¢Ğ• ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜Ğ®

    sudo nginx -t

Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ:
nginx: configuration file /etc/nginx/nginx.conf test is successful

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ğ¨ĞĞ“ 8: ĞŸĞ•Ğ Ğ•Ğ—ĞĞ“Ğ Ğ£Ğ—Ğ˜Ğ¢Ğ• NGINX

    sudo systemctl reload nginx

    # Ğ˜Ğ»Ğ¸
    sudo service nginx reload

    # Ğ˜Ğ»Ğ¸ Ğ´Ğ»Ñ Docker:
    docker exec nginx nginx -s reload

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… Ğ“ĞĞ¢ĞĞ’Ğ!

ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ: https://dashboardmorent.vercel.app
ĞÑˆĞ¸Ğ±ĞºĞ¸ CORS Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ¸ÑÑ‡ĞµĞ·Ğ½ÑƒÑ‚ÑŒ!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ ĞŸĞĞ›ĞĞ«Ğ™ ĞŸĞ Ğ˜ĞœĞ•Ğ  ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜Ğ˜ NGINX:

server {
    listen 443 ssl http2;
    server_name 1.cycloscope.online;

    # SSL Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸...

    location / {
        # CORS headers
        set $cors_origin "";
        if ($http_origin ~* (https://morent-sochi\.vercel\.app|https://dashboardmorent\.vercel\.app)) {
            set $cors_origin $http_origin;
        }
        
        add_header 'Access-Control-Allow-Origin' $cors_origin always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, PATCH, DELETE, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization' always;
        add_header 'Access-Control-Allow-Credentials' 'true' always;
        
        # Handle preflight
        if ($request_method = 'OPTIONS') {
            add_header 'Access-Control-Allow-Origin' $cors_origin always;
            add_header 'Access-Control-Allow-Methods' 'GET, POST, PATCH, DELETE, OPTIONS' always;
            add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization' always;
            add_header 'Access-Control-Max-Age' 86400;
            add_header 'Content-Type' 'text/plain charset=UTF-8';
            add_header 'Content-Length' 0;
            return 204;
        }
        
        # Proxy to Directus
        proxy_pass http://localhost:8055;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â“ Ğ•Ğ¡Ğ›Ğ˜ ĞĞ• ĞĞĞ¨Ğ›Ğ˜ NGINX ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜Ğ®:

Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Docker Ğ¸Ğ»Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°.
Ğ’ ÑÑ‚Ğ¾Ğ¼ ÑĞ»ÑƒÑ‡Ğ°Ğµ Ğ¿Ñ€Ğ¾Ñ‰Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ CORS Ğ² Directus Ñ‡ĞµÑ€ĞµĞ· .env

Ğ¡Ğ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚Ğµ: Ğ¢ĞĞ§ĞĞĞ¯-Ğ˜ĞĞ¡Ğ¢Ğ Ğ£ĞšĞ¦Ğ˜Ğ¯.txt

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¡ Ğ¡ĞĞ’Ğ•Ğ¢:

ĞŸĞµÑ€ĞµĞ´ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸ĞµĞ¼ ÑĞ´ĞµĞ»Ğ°Ğ¹Ñ‚Ğµ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½ÑƒÑ ĞºĞ¾Ğ¿Ğ¸Ñ:

    sudo cp /etc/nginx/sites-available/directus /etc/nginx/sites-available/directus.backup
