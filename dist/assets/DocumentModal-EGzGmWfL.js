import{r as m,j as e,X as D,S as R,P as V,c as _,A as O,T as P,D as F,C as X,a as B,d as K,e as N,f as L}from"./index-wrKaCGM-.js";import{M as W}from"./Modal-BlvMQvnA.js";const q=["Есть","Нет","Истек","Скоро истекает"],G=()=>N.endsWith("/")?N.slice(0,-1):N,H=l=>{const r=l.fileId||l.id;if(r){const a=`?access_token=${L}`;return`${G()}/assets/${r}${a}`}return l.fileUrl?l.fileUrl:"#"},J=l=>{if(typeof l!="number"||!Number.isFinite(l))return"";if(l===0)return"0 Б";const r=["Б","КБ","МБ","ГБ","ТБ"],a=Math.floor(Math.log(l)/Math.log(1024)),u=l/Math.pow(1024,a);return`${u.toFixed(u>=10?0:1)} ${r[a]}`},Z=({ownerName:l,documentName:r,documentData:a,onClose:u,onUpdate:C})=>{const[o,p]=m.useState(!1),[n,h]=m.useState(a),[g,v]=m.useState(!1),[w,b]=m.useState(null),y=m.useRef(null);m.useEffect(()=>{h(a)},[a]);const c=s=>{const{name:i,value:d}=s.target;h(t=>({...t,[i]:d===""?void 0:d}))},I=()=>{C(n),p(!1)},S=()=>{h(a),p(!1)},$=()=>{var s;g||(b(null),(s=y.current)==null||s.click())},E=async s=>{var d;const i=(d=s.target.files)==null?void 0:d[0];if(!i){s.target.value="";return}v(!0),b(null);try{const t=await K(i),x=(t==null?void 0:t.id)||`file-${Date.now()}`,M=((t==null?void 0:t.uploaded_on)||new Date().toISOString()).split("T")[0],z={id:x,version:(Array.isArray(n.versions)?n.versions.length:0)+1,fileName:(t==null?void 0:t.filename_download)||(t==null?void 0:t.title)||i.name,uploadDate:M,fileId:x,filesize:typeof(t==null?void 0:t.filesize)=="number"?t.filesize:i.size};h(j=>{const T=Array.isArray(j.versions)?j.versions:[];return{...j,versions:[...T,z]}})}catch(t){b((t==null?void 0:t.message)||"Не удалось загрузить файл. Повторите попытку.")}finally{v(!1),s.target.value=""}},U=s=>{h(i=>{const t=(Array.isArray(i.versions)?i.versions:[]).filter(x=>x.id!==s);return{...i,versions:t.map((x,k)=>({...x,version:k+1}))}})},A=()=>o?e.jsxs("div",{className:"flex items-center justify-end space-x-2 w-full",children:[e.jsx("button",{type:"button",onClick:S,className:"text-white bg-slate-600 hover:bg-slate-700 border border-slate-500 focus:outline-none focus:ring-4 focus:ring-slate-500 font-medium rounded-lg text-sm px-5 py-2.5",children:"Отмена"}),e.jsx("button",{type:"button",onClick:I,className:"text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5",children:"Сохранить"})]}):e.jsxs("div",{className:"flex items-center justify-end space-x-2 w-full",children:[e.jsx("button",{type:"button",onClick:u,className:"text-white bg-slate-600 hover:bg-slate-700 border border-slate-500 focus:outline-none focus:ring-4 focus:ring-slate-500 font-medium rounded-lg text-sm px-5 py-2.5",children:"Закрыть"}),e.jsxs("button",{type:"button",onClick:()=>p(!0),className:"inline-flex items-center gap-2 text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5",children:[e.jsx(B,{className:"w-4 h-4"}),"Редактировать"]})]}),f="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5";return e.jsx(W,{title:o?`Редактирование: ${r}`:`${r} / ${l}`,onClose:u,footer:A(),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-slate-200 mb-2",children:"Статус и даты"}),o?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block mb-2 text-sm font-medium text-white",children:"Статус"}),e.jsx("select",{id:"status",name:"status",value:n.status,onChange:c,className:f,children:q.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"signingDate",className:"block mb-2 text-sm font-medium text-white",children:"Дата подписания"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",id:"signingDate",name:"signingDate",value:n.signingDate||"",onChange:c,className:`${f} pr-8`}),n.signingDate&&e.jsx("button",{type:"button",onClick:()=>c({target:{name:"signingDate",value:""}}),className:"absolute inset-y-0 right-0 flex items-center pr-2 text-slate-400 hover:text-slate-200","aria-label":"Очистить дату подписания",children:e.jsx(D,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expirationDate",className:"block mb-2 text-sm font-medium text-white",children:"Дата окончания"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",id:"expirationDate",name:"expirationDate",value:n.expirationDate||"",onChange:c,className:`${f} pr-8`}),n.expirationDate&&e.jsx("button",{type:"button",onClick:()=>c({target:{name:"expirationDate",value:""}}),className:"absolute inset-y-0 right-0 flex items-center pr-2 text-slate-400 hover:text-slate-200","aria-label":"Очистить дату окончания",children:e.jsx(D,{className:"w-5 h-5"})})]})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-slate-700/50 p-3 rounded-lg md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-slate-400",children:"Статус"}),e.jsx("p",{className:"font-medium text-slate-200",children:a.status})]}),e.jsxs("div",{className:"bg-slate-700/50 p-3 rounded-lg",children:[e.jsx("label",{className:"block text-xs text-slate-400",children:"Дата подписания"}),e.jsx("p",{className:"font-medium text-slate-200",children:a.signingDate||"—"})]}),e.jsxs("div",{className:"bg-slate-700/50 p-3 rounded-lg",children:[e.jsx("label",{className:"block text-xs text-slate-400",children:"Дата окончания"}),e.jsx("p",{className:"font-medium text-slate-200",children:a.expirationDate||"—"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"text-md font-semibold text-slate-200",children:"Версии документа"}),o&&e.jsx("button",{onClick:$,type:"button",disabled:g,className:"inline-flex items-center gap-1 text-sm font-medium text-blue-400 hover:text-blue-300 disabled:opacity-60 disabled:cursor-not-allowed",children:g?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 animate-spin"}),"Загрузка..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4"}),"Добавить файл"]})})]}),e.jsx("input",{ref:y,type:"file",accept:".pdf,.doc,.docx,.png,.jpg,.jpeg,.xls,.xlsx",onChange:E,className:"hidden"}),w&&e.jsx("p",{className:"mt-2 text-xs text-red-400",children:w}),(n.versions||[]).length>0?e.jsx("ul",{className:"border border-slate-700 rounded-lg divide-y divide-slate-700",children:n.versions.map(s=>e.jsxs("li",{className:"p-3 flex items-center justify-between hover:bg-slate-700/50",children:[e.jsxs("div",{className:"flex items-center min-w-0",children:[e.jsx(_,{className:"w-5 h-5 mr-3 text-slate-400 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:s.fileName}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Версия ",s.version,", загружен ",s.uploadDate,typeof s.filesize=="number"?` · ${J(s.filesize)}`:""]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("a",{href:H(s),download:s.fileName,className:"p-2 rounded-md hover:bg-slate-600",children:e.jsx(O,{className:"w-5 h-5 text-slate-400"})}),o&&e.jsx("button",{type:"button",onClick:()=>U(s.id),className:"p-2 rounded-md hover:bg-red-900/50 text-slate-400 hover:text-red-300 transition-colors","aria-label":"Удалить файл",children:e.jsx(P,{className:"w-5 h-5"})})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 px-4 border-2 border-dashed border-slate-600 rounded-lg",children:[e.jsx(F,{className:"mx-auto h-10 w-10 text-slate-400"}),e.jsx("p",{className:"mt-2 text-sm font-medium text-slate-300",children:"Файлы не загружены"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Загрузите первый файл документа."})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-slate-200 mb-2",children:"История и примечания"}),o?e.jsx("textarea",{id:"notes",name:"notes",rows:3,value:n.notes||"",onChange:c,className:f,placeholder:"Добавьте примечание..."}):a.notes?e.jsxs("div",{className:"flex items-start bg-slate-700/50 p-3 rounded-lg",children:[e.jsx(X,{className:"w-4 h-4 mr-3 mt-1 text-slate-400 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-slate-300 whitespace-pre-wrap",children:a.notes})]}):e.jsx("p",{className:"text-sm text-slate-400 italic",children:"Примечаний нет."})]})]})})};export{Z as default};
