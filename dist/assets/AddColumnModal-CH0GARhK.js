import{r,j as e,g as s,S as g,T as U,h as A,i as O,k as f,l as $}from"./index-CMZJwJjD.js";import{M as q}from"./Modal-CKq2Esk8.js";const W=({onClose:N,onAddColumn:j,onDeleteColumn:y,existingColumns:c})=>{const[i,d]=r.useState(1),[l,m]=r.useState(null),[o,T]=r.useState(""),[x,w]=r.useState(!1),[u,C]=r.useState(!1),[b,h]=r.useState(!1),[k,p]=r.useState(null),E=()=>{l&&d(2)},v=async()=>{if(!o.trim()||!l)return;const t={id:`col-${Date.now()}`,name:o.trim(),type:l,...l===s.DOCUMENT&&{required:x,trackExpiration:u},...l===s.ATTRIBUTE&&{attributeType:f.TEXT}};try{h(!0),await j(t)}finally{h(!1)}},S=async(t,a)=>{if(!a)try{p(t),await y(t)}finally{p(n=>n===t?null:n)}},D=t=>{switch(t.type){case s.DOCUMENT:return t.trackExpiration?"Документ · Сроки":"Документ";case s.ATTRIBUTE:return`Атрибут · ${t.attributeType??f.TEXT}`;case s.OWNER:return"Системная колонка";default:return t.type}},I=()=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-slate-200 mb-4",children:"1. Выберите тип колонки"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>m(s.DOCUMENT),className:`p-4 border rounded-lg text-center transition-all ${l===s.DOCUMENT?"border-blue-500 bg-blue-900/50 ring-2 ring-blue-500":"border-slate-600 hover:border-blue-500"}`,children:[e.jsx(A,{className:"w-8 h-8 mx-auto mb-2 text-blue-500"}),e.jsx("span",{className:"font-semibold text-sm text-white",children:"Документ"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Отслеживание файлов, статусов и сроков."})]}),e.jsxs("button",{onClick:()=>m(s.ATTRIBUTE),className:`p-4 border rounded-lg text-center transition-all ${l===s.ATTRIBUTE?"border-green-500 bg-green-900/50 ring-2 ring-green-500":"border-slate-600 hover:border-green-500"}`,children:[e.jsx(O,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsx("span",{className:"font-semibold text-sm text-white",children:"Атрибут"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Текст, число, дата или другой тип данных."})]})]})]}),R=()=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-slate-200 mb-4",children:"2. Задайте параметры"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"columnName",className:"block mb-2 text-sm font-medium text-white",children:"Название колонки"}),e.jsx("input",{type:"text",id:"columnName",value:o,onChange:t=>T(t.target.value),className:"bg-slate-700 border border-slate-600 text-white placeholder-slate-400 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5",placeholder:"Например, 'Доверенность'",required:!0})]}),l===s.DOCUMENT&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-slate-700",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:t=>w(t.target.checked),className:"w-4 h-4 text-blue-600 bg-slate-700 border-slate-600 rounded focus:ring-blue-600 ring-offset-slate-800 focus:ring-2"}),e.jsx("span",{className:"ms-2 text-sm font-medium text-slate-300",children:"Обязательность"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:t=>C(t.target.checked),className:"w-4 h-4 text-blue-600 bg-slate-700 border-slate-600 rounded focus:ring-blue-600 ring-offset-slate-800 focus:ring-2"}),e.jsx("span",{className:"ms-2 text-sm font-medium text-slate-300",children:"Отслеживать срок действия"})]})]})]})]}),M=()=>{if(i===1)return e.jsxs("button",{type:"button",onClick:E,disabled:!l,className:"inline-flex items-center text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 disabled:bg-blue-500 disabled:cursor-not-allowed",children:["Далее ",e.jsx($,{className:"w-4 h-4 ml-2"})]});if(i===2)return e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>d(1),className:"text-white bg-slate-600 hover:bg-slate-700 border border-slate-500 focus:outline-none focus:ring-4 focus:ring-slate-500 font-medium rounded-lg text-sm px-5 py-2.5",children:"Назад"}),e.jsxs("button",{type:"button",onClick:v,disabled:!o.trim()||b,className:"inline-flex items-center justify-center gap-2 text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 disabled:bg-blue-500 disabled:cursor-not-allowed",children:[b&&e.jsx(g,{className:"w-4 h-4 animate-spin"}),"Добавить колонку"]})]})};return e.jsxs(q,{title:"Мастер создания новой колонки",onClose:N,footer:e.jsx("div",{className:"flex space-x-2",children:M()}),children:[i===1&&I(),i===2&&R(),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-md font-semibold text-slate-200 mb-3",children:"Существующие колонки"}),c.length===0?e.jsx("p",{className:"text-sm text-slate-400",children:"Колонки ещё не созданы."}):e.jsx("ul",{className:"space-y-2 max-h-48 overflow-y-auto pr-1",children:c.map(t=>{const a=t.type===s.OWNER,n=k===t.id;return e.jsxs("li",{className:"flex items-center justify-between p-3 bg-slate-800/60 border border-slate-700 rounded-lg",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-white truncate",children:t.name}),e.jsx("p",{className:"text-xs text-slate-400 mt-1 truncate",children:D(t)})]}),e.jsxs("button",{type:"button",onClick:()=>S(t.id,a),disabled:a||n,className:`inline-flex items-center gap-2 text-sm font-medium px-3 py-1.5 rounded-md transition-colors ${a?"text-slate-500 cursor-not-allowed border border-slate-600":"text-red-300 border border-red-500/40 hover:bg-red-900/40"}`,children:[n?e.jsx(g,{className:"w-4 h-4 animate-spin"}):e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{children:a?"Системная":"Удалить"})]})]},t.id)})})]})]})};export{W as default};
